<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>cloud_detail</title>
  <link rel="stylesheet" href="/css/style.css">
  <style>
    a {
      text-decoration: none; /* å»é™¤ä¸‹åˆ’çº¿ */
    }
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }

    /* åˆ›å»ºä¸€ä¸ªæ•´ä½“çš„å®¹å™¨ï¼Œä½¿ç”¨flexå¸ƒå±€ */
    .container { }

    /* å¤´éƒ¨åŒºåŸŸ */
    header {
      background-color: var(--header-color);
      height: 60px;
      width: 100%;
      color: white;
      text-align: center;
      line-height: 60px;
    }

    header .content {
      margin: auto;
      width: 800px;
      height: 100%;
    }

    header .logo {
      float: left;
      margin-top: 5px;
    }

    header .logo img {
      height: 50px;
    }

    header .block {
      float: right;
      margin-left: 20px;
      width: 100px;
      background-color: var(--header-block-color);
    }
    header .block a{
      font-size: 20px;
      color: var(--header-bolck-fcolor);
      font-weight: bolder;
    }
    /*hover*/
    header .block :hover{
      float: right;
      margin-left: 20px;
      width: 100px;
      background-color: var(--header-block-hover-color);
    }
    /* æ¿€æ´»çŠ¶æ€ */
    .block.active {
      background-color: var(--header-block-hover-color);
      color: white;
    }

    /* ä¸­é—´å†…å®¹éƒ¨åˆ†ï¼ŒæŒ‡å®šå›ºå®šçš„é•¿å®½å¹¶å±…ä¸­ */
    main {
      margin: auto;
      background-color: #f8f8f8;
      width: 800px;
    }


    main .mainTitle{
      height: 100px;
      width: 800px;
      margin: auto;
      display: flex;
      justify-content: center; /* æ°´å¹³å±…ä¸­å¯¹é½ */
      align-items: center;     /* å‚ç›´å±…ä¸­å¯¹é½ */
      text-align: center;
      font-size: 50px;
      font-weight: bolder;
      background-color: var(--main-title-color);
      color:var(--main-title-fcolor);
    }

    main .cloudinfo {
      /*height: 600px;*/
      margin-top: 20px;

      /*background-color: #377060;*/
    }
    main .cloudinfo  .cloudImg {
      width: 800px;

      /*background-color: #d4eb7b;*/
    }
    main .cloudinfo img {
      width: 800px;

      background-color: #404238;
    }
    main .cloudinfo .cloudtext{
      /*height: 100px;*/

      font-size: 30px;
      font-weight: lighter;
      background-color: #e7edf0;
    }

    /* åº•éƒ¨åŒºåŸŸ */
    footer {
      background-color: var(--footer-color);
      height: 300px;
      width: 100%;
      text-align: center;
      line-height: 60px;
      margin-top: auto;
      padding-top: 50px;
    }
    footer .creatorLogo {
      width: 100%;
      height: 70px;
      /*margin-left:auto;*/
      /*margin-top: 20px;*/
      /*background-color: #fff;*/
    }

    footer .creatorLogo img {
      height: 70px;
    }
    footer .creatorInfo{
      height: 100px;
      width: 100%;
      margin-top: 20px;
      text-align: center;
      line-height: 20px;
      font-size: 25px;
      font-weight: lighter;
      color: var(--footer-fcolor);
      /*background-color: rgba(255, 255, 255, 0.51);*/
    }

    /*æŸ¥çœ‹å¤§å›¾*/
    .modal {
      display: none;
      position: fixed;
      z-index: 1;
      padding-top: 100px;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgb(0,0,0);
      background-color: rgba(0,0,0,0.9);
    }

    .modal-content {
      margin: auto;
      display: block;
      width: 80%;
      max-width: 700px;
    }

    .close {
      position: absolute;
      top: 20px;
      right: 35px;
      color: #f1f1f1;
      font-size: 40px;
      font-weight: bold;
      transition: 0.3s;
    }

    .close:hover,
    .close:focus {
      color: #bbb;
      text-decoration: none;
      cursor: pointer;
    }



  /*  postæ ·å¼*/
    .postContainer {
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 16px;
      background-color: #ffffff;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .meinfo {
      display: flex;
      flex-direction: column;
      gap: 12px;
      background-color: #f0fff3;
    }

    .profile_pic {
      float: left;
      width: 100px;
      height: 100px;
      margin: 10px;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
      border: 2px solid #53e4bd;
    }

    .profile_name {
      margin-left: 35px;
      font-size: 26px;
      font-weight: bold;
      color: #333333;
    }

    .post_pic {
      width: 100%;
      height: 400px;
      background-size: cover;
      background-position: center;
      border-radius: 8px;
    }

    .post_text {
      padding: 10px;
      margin: 10px;
      font-size: 20px;
      color: #555555;
      background-color: #e1e7e8;
      line-height: 1.5;
    }
    .create_time{
      float: right;
      height: 30px;
      width: 210px;
      margin-top:80px;
      background-color: rgba(255, 255, 255, 0.35);
    }
    .comment_section {
      margin-top: 32px;
    }

    .comment-item {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 20px;
      background-color: #f1e7d9;
    }

    .comment-item .profile_pic {
      float: left;
      margin: 10px;
      width: 40px;
      height: 40px;
    }

    .comment-item .profile_name {
      float: left;
      margin: 10px;
      margin-top: 18px;
      font-size: 20px;
      font-weight: 600;
      color: #444444;
    }

    .comment-item .comment_text {
      float: left;
      width: 700px;
      margin-left: 10px;
      margin-top: 20px;
      margin-bottom: 10px;
      padding: 10px;
      font-size: 20px;
      color: #2e4047;
      font-weight: bolder;
      background-color: #cfebeb;
    }


    /*å¸–å­å¤šå›¾å¤„ç†*/
    .post_pic .button {

      background-color: #333;
      color: white;
      border: none;
      margin-top: 200px;
      /*padding: 10px 15px;*/
      font-size: 30px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      /*position: absolute;*/
      /*top: 50%;*/
      /*transform: translateY(-50%);*/
      /*z-index: 1; !* ç¡®ä¿æŒ‰é’®æ˜¾ç¤ºåœ¨å›¾ç‰‡ä¸Šæ–¹ *!*/
      z-index: 100;
    }

    /* é¼ æ ‡æ‚¬åœåœ¨æŒ‰é’®ä¸Šçš„æ•ˆæœ */
    .post_pic .button:hover {
      background-color: #555;
    }

    /* å·¦æŒ‰é’®çš„ä½ç½® */
    .left {
      float:left;
      margin-left: 10px;
    }

    /* å³æŒ‰é’®çš„ä½ç½® */
    .right {
      float:right;
      margin-right: 10px;
    }


    div[id^="currentImgNumBox_"] {
      width: 80px;
      height: 50px;
      float: right;

      margin-left: 700px;
      margin-top: 10px;
      background-color: rgb(122, 191, 223);
      /*position: fixed;*/
      /*top: 90%;*/
      /*left: 90%;*/
      color: white;
      /*border: none;*/
      /*padding: 10px;*/
      z-index: 1000;

      font-weight: bolder;
      font-size: larger;
    }


    .post_like{
      float: right;
      height: 50px;
      width: 100px;
      margin-left: 650px;
      margin-top: 20px;
      /*background-color: #cce9d0;*/
      color: white;
    }

    .post_like .like_num_post{
      float: right;
      height: 50px;
      width: 50px;
      color: #031a42;
      font-size: 25px;
      font-weight: bolder;
      line-height: 50px;
    }
    .post_like .like_btn{
      float: right;
      height: 50px;
      width: 50px;
      border-radius: 50%;
      background-color: rgba(109, 200, 227, 0.52);
      cursor: pointer; /* æ·»åŠ æ­¤å±æ€§ä»¥æ›´æ”¹é¼ æ ‡æ ·å¼ */

      font-size: 25px;
      font-weight: bolder;
      line-height: 50px;

    }



    main .comment_section .comment_like{
      float: right;
      height: 20px;
      width: 50px;
      margin-right: 40px;
      margin-top: 10px;
      margin-bottom: 10px;
      color: white;
    }
    main .comment_section .comment_like .like_btn{
      float: left;
      height: 20px;
      width: 20px;
      border-radius: 50%;
      background-color: rgba(109, 200, 227, 0.52);
      cursor: pointer; /* æ·»åŠ æ­¤å±æ€§ä»¥æ›´æ”¹é¼ æ ‡æ ·å¼ */
    }

    main .comment_section .comment_like .like_num_comment{
      float: right;
      height: 20px;
      width: 20px;
      color: #031a42;
      line-height: 20px;
      font-size: 20px;
    }

    .post_comment{
      float: left;
      height: 20px;
      width: 720px;
      margin-left: 20px;
      margin-top: 20px;
      margin-bottom: 20px;
      background-color: rgba(242, 251, 251, 0.56);
    }


    /* æ•´ä½“è¯„è®ºåŒºåŸŸæ ·å¼ */
    .post_comment {
      margin-top: 20px;
      padding: 10px;
      background-color: #f9f9f9;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    /* è¯„è®ºè¡¨å•æ ·å¼ */
    .commentForm {
      height: 20px;
      width: 720px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* è¯„è®ºè¾“å…¥æ¡†æ ·å¼ */
    .commentForm input[type="text"] {
      flex: 1;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 14px;
      background-color: #fff;
      outline: none;
      transition: border-color 0.3s ease;
    }

    .commentForm input[type="text"]:focus {
      border-color: #007bff;
    }

    /* æäº¤æŒ‰é’®æ ·å¼ */
    .commentForm input[type="submit"] {
      float: right;
      width: 100px;
      padding: 8px 16px;
      background-color: #007bff;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.3s ease;
    }

    .commentForm input[type="submit"]:hover {
      background-color: #0056b3;
    }

    /* éšè—çš„è¾“å…¥æ¡†æ ·å¼ */
    .commentForm input[type="hidden"] {
      display: none;
    }
  </style>
</head>
<body>
<div class="container">
  <header>
    <div class="content">
      <div class="logo">
        <a href="/index">
          <img src="/images/logo.png" alt="Cloud Website Logo">
        </a>
      </div>
      <div id="me" class="block">
        <a href="/me">me</a>
      </div>
      <div id="classify" class="block">
        <a href="/classify">classify</a>
      </div>
      <div id="forum" class="block">
        <a href="/forum">forum</a>
      </div>
      <div id="know" class="block">
        <a href="/know">know</a>
      </div>
    </div>
  </header>
  <main>
    <div class="mainTitle" ><p></p></div>
    <div id="myModal" class="modal">
      <span class="close" onclick="closeModal()">&times;</span>
      <img class="modal-content" id="img01">
    </div>

    <div class="postContainer">
        <div class="meinfo">
<!--          <div class="profile_pic" id="profile_pic" th:style="'background: #53e4bd url(' + '\'' + '/images/profiles/' + ${post.userId} + '.jpg'+'\'' + ') no-repeat center center;'"></div>-->
<!--          <div class="profile_name" th:text="${post.userName}"></div>-->
<!--          <div class="post_pic" th:style="'background: #53e4bd url(' + '\'' + '/images/' + ${post.postImgPath} + '\'' + ') no-repeat center center;'"></div>-->
<!--          <div class="post_text" th:text="${post.postText}"></div>-->
<!--          <div class="post_like" data-postId="${post.postId}">-->
<!--            <div class="like_btn" onclick="likePost('${post.postId}')">ğŸ‘</div>-->
<!--            <div class="like_num_post">${post.postLike}</div>-->
<!--          </div>-->
        </div>
        <div class="comment_section">
<!--          <div class="comment-item" th:each="comment:${comments}" th:if="${comment.postId} == ${post.postId}">-->
<!--            <div class="userinfo">-->
<!--              <div class="profile_pic" th:style="'background: #53e4bd url(' + '\'' + '/images/profiles/' + ${comment.userId} + '.jpg'+'\'' + ') no-repeat center center;'"></div>-->
<!--              <div class="profile_name" th:text="${comment.userName}"></div>-->
<!--              <div class="comment_text" th:text="${comment.commentText}"></div>-->
    <!--          <div class="comment_like" th:attr="data-commentId=${comment.commentId}">-->
    <!--            <div class="like_btn" th:attr="onclick=|likeComment('${comment.commentId}')|">ğŸ‘</div>-->
    <!--            <div class="like_num_comment" th:text="${comment.commentLike}"></div>-->
    <!--          </div>-->
<!--            </div>-->
<!--          </div>-->
        </div>

    </div>

  </main>
  <footer>
    <div class="creatorLogo">
      <img src="/images/creatorLogo.jpg">
    </div>
    <div class="creatorInfo">
      <p>CREATOR:TAN</p>
      <p>EMAIL:tanyawen2640@gmail.com</p>
      <p>PHONE:13527800350</p>
    </div>
  </footer>
</div>
<script th:inline="javascript">
  /*<![CDATA[*/
  var postId = /*[[${session.postId}]]*/ null;  // è·å– session ä¸­çš„ postId
  /*<![CDATA[*/
  var userLogin = /*[[${session.userLogin}]]*/ null;
  // JavaScript ç¤ºä¾‹
  window.onload = function() {
    // è·å–å½“å‰é¡µé¢çš„æ–‡ä»¶å
    const currentPage = window.location.pathname.split("/").pop().replace('.html', '');

    // æ ¹æ®æ–‡ä»¶åç»™å¯¹åº”çš„å—æ·»åŠ  active ç±»
    const activeBlock = document.getElementById(currentPage);
    if (activeBlock) {
      activeBlock.classList.add('active');
    }
  };

  //å…¨å±€å˜é‡
  //currentIndex
  let currentIndex=0;
  //postçš„å›¾ç‰‡çš„æ•°é‡
  let lenOfPostsImgs=0;

  function initLenOfPostsImgs(post){
    lenOfPostsImgs=post.postImgPaths.length;
  }


  // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥æ˜¯å¦æœ‰JWTï¼Œå¦‚æœæ²¡æœ‰åˆ™é‡å®šå‘åˆ°ç™»å½•é¡µ
  window.onload = function() {
    const token = localStorage.getItem('authToken');
    console.log(token);
    if (token==='null') {
      alert('æœªç™»å½•,æ— jwtä»¤ç‰Œ.');
      window.location.href = '/toLogin';  // æœªç™»å½•æ—¶è·³è½¬åˆ°ç™»å½•é¡µé¢
    } else {

      // å¦‚æœæœ‰JWTï¼Œåˆ™å¯ä»¥ç»§ç»­åŠ è½½é¡µé¢å†…å®¹
      loadDetail(token);
    }
  };

  function loadImgIndex(postId){
    index=currentIndex+1;
    total=lenOfPostsImgs;
    const currentImgNumBox = document.getElementById('currentImgNumBox_'+postId);
    console.log('currentImgNumBox_'+postId);
    currentImgNumBox.textContent=index+"/"+total;
  }
  //åˆ‡æ¢å›¾ç‰‡
  function changeImg(btnId,post){
    if(lenOfPostsImgs==1){
      return;
    }
    console.log("~~~~~~~~~~~~~~~~~~~changeImg");
    const str = btnId;
    const direction=str.substring(0,4);
    console.log("direction:"+direction);
    const parts = str.split("_");
    if (parts.length > 1) {
      const postIndex = parseInt(parts[1], 10)-1;
      console.log(postIndex);
      console.log(direction);

      if (direction === 'prev') {
        newIndex = (currentIndex - 1 + lenOfPostsImgs) % lenOfPostsImgs;
      } else {
        newIndex = (currentIndex + 1) % lenOfPostsImgs;
      }
      currentIndex= newIndex;
      console.log("newIndex:"+currentIndex);
      // æ›´æ–°å›¾ç‰‡çš„èƒŒæ™¯å›¾ï¼Œè¿™é‡Œç®€å•å‡è®¾å›¾ç‰‡è·¯å¾„çš„è§„å¾‹ï¼Œå¯æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹
      const postPic = document.getElementById(`post_pic`);
      console.log("æ›´æ”¹å‰ï¼š"+postPic.style);
      if (postPic) {
        // <div id="post_pic_${post.postId}" class="post_pic" onclick="openModal('/images/${post.postImgPaths[postImgIndexList[postId-1]]}')"  style="background: #53e4bd url('/images/${post.postImgPaths[postImgIndexList[postId-1]]}') no-repeat center center;">

        //æ›´æ”¹æ ·å¼
        postPic.style = `background: #53e4bd url('/images/${post.postImgPaths[currentIndex]}') no-repeat center center;`;
        //æ›´æ”¹onclick
        postPic.onclick = () => openModal(`/images/${post.postImgPaths[currentIndex]}`);
      }

      //æ›´æ”¹index/total
      loadImgIndex(postIndex+1);

      console.log("æ›´æ”¹åï¼š"+postPic.style);
    }


  }
  // åŠ è½½Postå†…å®¹
  function loadDetail(token) {
    console.log(loadDetail);
    fetch(`/post/getPostDetail?postId=${postId}`, {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${token}`  // ç¡®ä¿ä½ æœ‰æ­£ç¡®çš„ token
      }
    })
            .then(response => response.json())
            .then(data => {
              // æ£€æŸ¥è¿”å›çš„ data æ˜¯å¦åŒ…å«æœŸæœ›çš„ç»“æ„
              if (data.code === 1 && null!=data.data) {
                const post = data.data;
                initLenOfPostsImgs(post);
                // ç”Ÿæˆå¸–å­éƒ¨åˆ†
                const meinfo = document.querySelector(".meinfo");
                const isUserLoggedIn = userLogin !== null;
                meinfo.innerHTML = `

                      <div class="profile_pic" style="background: #53e4bd url('/images/${post.userProfilePath}') no-repeat center center; background-size: cover;"></div>
                      <div class="profile_name">${post.userName}</div>
                      <div class="post_pic" id="post_pic" style="background: #53e4bd url('/images/${post.postImgPaths[0]}') no-repeat center center; background-size: cover;">
                        <button class="button left" id="prevButton_${post.postId}">&lt;</button>
                        <button class="button right" id="nextButton_${post.postId}">&gt;</button>
                      </div>
                      <div class="currentImgNumBox" id="currentImgNumBox_${post.postId}">${currentIndex+1}/${lenOfPostsImgs}</div>
                      <div class="post_text">${post.postText}
                            <div class="create_time">${post.createTime}</div>
                      </div>

                      <div class="post_comment" style="display: ${isUserLoggedIn ? 'block' : 'none'};">
                        <form id="commentForm_${post.postId}" class="commentForm">
                            <input type="hidden" name="userId" id="userId" value="${userLogin ? userLogin.userId : ''}">
                            <input type="hidden" name="postId" id="postId" value="${post.postId}">
                            <input type="text" name="commentText" id="commentText" placeholder="Write your comment" style="border: none; background-color: transparent; outline: none;">
                            <input type="submit" value="æäº¤è¯„è®º" data-postId="${post.postId}">
                        </form>
                      </div>

                      <div class="post_like" data-postId="${post.postId}">
                        <div class="like_btn" onclick="likePost('${post.postId}')">ğŸ‘</div>
                        <div class="like_num_post">${post.postLike}</div>
                      </div>
                `;


                //æ›´æ”¹index/total
                loadImgIndex(post.postId);
                //ä¸ºæ¯ä¸€ä¸ªpostçš„æŒ‰é’®æ·»åŠ ç›‘å¬
                // é€‰æ‹©æ‰€æœ‰æŒ‰é’®
                const allButtons = meinfo.querySelectorAll('button');

                // ä¸ºæ¯ä¸ªæŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬
                allButtons.forEach(button => {
                  button.addEventListener('click', function (event) {
                    event.stopPropagation();
                    console.log(`æŒ‰é’® ${this.id} è¢«ç‚¹å‡»äº†`);
                    changeImg(this.id,post);

                  });
                });


                //æäº¤è¯„è®ºå¤„formç›‘å¬
                const commentForms = document.querySelectorAll('.commentForm');
                commentForms.forEach(form => {
                  form.addEventListener('submit', async function (event) {
                    event.preventDefault(); // é˜»æ­¢é»˜è®¤è¡¨å•æäº¤è¡Œä¸º
                    console.log("~~~~~~~~~~~formid:"+form.id);
                    const token = localStorage.getItem('authToken');  // è·å–æœ¬åœ°å­˜å‚¨ä¸­çš„token
                    // è·å–æäº¤æŒ‰é’®å…ƒç´ 
                    const submitButton = event.submitter;

                    const userId = document.querySelector('#userId').value;
                    const postId = submitButton.getAttribute('data-postid');
                    // const commentText = document.querySelector('#commentText').value;

                    const commentText = form.querySelector('input[name="commentText"]').value;

                    console.log("postId:"+postId+" userId:"+userId+" commentText:"+commentText);
                    // åˆ›å»ºè¯·æ±‚ä½“
                    const requestBody = {
                      userId: userId,
                      postId: postId,
                      commentText: commentText
                    };
                    console.log("å‘é€è¯„è®º"+requestBody);
                    try {
                      // å‘é€ Fetch è¯·æ±‚
                      const response = await fetch('/post/submitComment', {
                        method: 'POST',
                        headers: {
                          'Authorization': `Bearer ${token}`,  // è®¾ç½® Authorization å¤´
                          'Content-Type': 'application/json'  // å‘é€ JSON æ•°æ®
                        },
                        body: JSON.stringify(requestBody)  // å°†æ•°æ®è½¬ä¸º JSON å­—ç¬¦ä¸²
                      });
                      console.log()
                      // æ£€æŸ¥å“åº”çŠ¶æ€
                      if (!response.ok) {
                        throw new Error('ç½‘ç»œå“åº”å¤±è´¥');
                      }

                      // è§£æè¿”å›çš„ JSON æ•°æ®
                      const result = await response.json();
                      console.log(result);
                      // æ ¹æ®è¿”å›çš„ Result å°è£…ä¿¡æ¯å¤„ç†
                      if (result.code === 1) {
                        // è¯„è®ºæˆåŠŸ
                        loadDetail(token);
                        alert("è¯„è®ºå·²å‘é€ï¼");
                      } else {
                        alert(result.msg);
                      }
                    } catch (error) {
                      alert("è¯„è®ºå¤±è´¥");
                    }

                  })
                });

                loadComments(token,postId);



              } else {
                console.error('Invalid data structure:', data);
              }
            })
            .catch(error => {
              console.error('Error loading cloud types:', error);
            });
  }

  // åŠ è½½Commentså†…å®¹
  function loadComments(token,postId) {
    console.log("loadComments");
    fetch(`/post/getCommentsByPostId?postId=${postId}`, {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${token}`  // ç¡®ä¿ä½ æœ‰æ­£ç¡®çš„ token
      }
    })
            .then(response => response.json())
            .then(data => {
              // æ£€æŸ¥è¿”å›çš„ data æ˜¯å¦åŒ…å«æœŸæœ›çš„ç»“æ„
              if (data.code === 1 && null!=data.data) {
                const commentSection = document.querySelector(".comment_section");
                // æ¸…ç©ºç°æœ‰çš„è¯„è®ºå†…å®¹
                commentSection.innerHTML = "";

                // éå†è¯„è®ºæ•°æ®å¹¶ç”Ÿæˆ HTML
                data.data.forEach(comment => {
                  console.log(comment.postId+"  "+postId);
                  if (comment.postId.toString() === postId.toString()) {
                    console.log("comment.postId === postId");
                    const commentItem = `
                        <div class="comment-item">
                          <div class="userinfo">
                            <div class="profile_pic" style="background: #53e4bd url('/images/profiles/${comment.userId}.jpg') no-repeat center center; background-size: cover;"></div>
                            <div class="profile_name">${comment.userName}</div>
                            <div class="comment_text">${comment.commentText}</div>
                             <div class="comment_like" data-commentId="${comment.commentId}">
                                <div class="like_btn" onclick="likeComment('${comment.commentId}')">ğŸ‘</div>
                                <div class="like_num_comment">${comment.commentLike}</div>
                             </div>
                          </div>
                        </div>
                    `;
                    commentSection.innerHTML += commentItem;
                  }
                });
              } else {
                console.error('Invalid data structure:', data);
              }
            })
            .catch(error => {
              console.error('Error loading cloud types:', error);
            });
  }



  // æŸ¥çœ‹å¤§å›¾
  function openModal(imageUrl) {
    console.log("openModal:"+imageUrl);
    var modal = document.getElementById("myModal");
    var modalImg = document.getElementById("img01");
    modal.style.display = "block";
    modalImg.src = imageUrl;
  }

  function closeModal() {
    var modal = document.getElementById("myModal");
    modal.style.display = "none";
  }


  //ç‚¹èµ
  function likePost(postId) {
    console.log("likePost")
    const token = localStorage.getItem('authToken');  // è·å–æœ¬åœ°å­˜å‚¨ä¸­çš„token
    console.log("addEventListener:token"+token)
    fetch('/post/likePost/' + postId, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${token}`,  // è®¾ç½® Authorization å¤´
        'Content-Type': 'application/json'
      }
    })
            .then(response => response.json())
            .then(data => {
              if (data.code===1&& null!=data.data) {
                const postLikeElement = document.querySelector(`.post_like[data-postId='${postId}'] .like_num_post`);
                if (postLikeElement) {
                  console.log("æ›´æ–°postç‚¹èµæ•°æ®")
                  postLikeElement.textContent = data.data;
                }
              } else{
                alert(data.msg);
              }
            })
            .catch(error => console.error('Error:', error));
  }

  //ç‚¹èµ
  function likeComment(commentId) {
    console.log("likeComment")
    const token = localStorage.getItem('authToken');  // è·å–æœ¬åœ°å­˜å‚¨ä¸­çš„token

    console.log("addEventListener:token"+token)
    fetch('/post/likeComment/' + commentId, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${token}`,  // è®¾ç½® Authorization å¤´
        'Content-Type': 'application/json'
      }
    })
            .then(response => response.json())
            .then(data => {
              if (data.code===1&& null!=data.data) {
                // æ›´æ–°ç‚¹èµæ•°æ˜¾ç¤ºï¼Œå‡è®¾ class="post_like" æ˜¯æ˜¾ç¤ºç‚¹èµæ•°çš„å…ƒç´ 
                // document.querySelector('.like_num_comment').textContent =  data.newLikeCount;
                const commentLikeElement = document.querySelector(`.comment_like[data-commentId='${commentId}'] .like_num_comment`);
                if (commentLikeElement) {
                  commentLikeElement.textContent = data.data;
                }
              } else {
                alert(data.msg);
              }
            })
            .catch(error => console.error('Error:', error));
  }





</script>
</body>
</html>